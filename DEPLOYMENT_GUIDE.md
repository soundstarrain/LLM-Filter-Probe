# éƒ¨ç½²å’Œè¿ç»´æŒ‡å—

## å¿«é€Ÿå¯¼èˆª

æ ¹æ®ä½ çš„åœºæ™¯é€‰æ‹©åˆé€‚çš„éƒ¨ç½²æ–¹å¼ï¼š

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | è€—æ—¶ |
|------|---------|------|
| **æœ¬åœ°å¼€å‘** | [ä¸€é”®å¯åŠ¨è„šæœ¬](#ä¸€é”®å¯åŠ¨è„šæœ¬æ¨è) | 2-3 åˆ†é’Ÿ |
| **å®¹å™¨éƒ¨ç½²** | [Docker Compose](#docker-éƒ¨ç½²) | 3-5 åˆ†é’Ÿ |
| **ç”Ÿäº§ç¯å¢ƒ** | [Nginx + Gunicorn](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²) | 15-20 åˆ†é’Ÿ |
| **æ‰‹åŠ¨é…ç½®** | [è¯¦ç»†å®‰è£…æ­¥éª¤](#è¯¦ç»†å®‰è£…æ­¥éª¤) | 10-15 åˆ†é’Ÿ |

---

## ç›®å½•

1. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
2. [ä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰](#ä¸€é”®å¯åŠ¨è„šæœ¬æ¨è)
3. [è¯¦ç»†å®‰è£…æ­¥éª¤](#è¯¦ç»†å®‰è£…æ­¥éª¤)
4. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
5. [v1.2.0 æ–°åŠŸèƒ½é…ç½®](#v120-æ–°åŠŸèƒ½é…ç½®)
6. [Docker éƒ¨ç½²](#docker-éƒ¨ç½²)
7. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)
8. [ç›‘æ§å’Œæ—¥å¿—](#ç›‘æ§å’Œæ—¥å¿—)
9. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ç³»ç»Ÿè¦æ±‚

### è½¯ä»¶ç‰ˆæœ¬

| è½¯ä»¶ | æœ€ä½ç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ |
|------|---------|---------|
| Python | 3.9 | 3.11+ |
| Node.js | 16.0 | 18.0+ |
| npm | 8.0 | 9.0+ |
| Git | 2.20 | 2.40+ |

### æ“ä½œç³»ç»Ÿ

âœ… Windows 10 / 11  
âœ… macOS 10.15+  
âœ… Linux (Ubuntu 20.04+)

---

## ä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

**æœ€ç®€å•çš„å¯åŠ¨æ–¹å¼ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰é…ç½®ã€‚**

### è¿è¡Œè„šæœ¬

#### Windows

```bash
# æ–¹å¼ 1ï¼šç›´æ¥åŒå‡»
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰¾åˆ° start_system.batï¼ŒåŒå‡»è¿è¡Œ

# æ–¹å¼ 2ï¼šå‘½ä»¤è¡Œè¿è¡Œ
start_system.bat
```

#### macOS / Linux

```bash
bash start_system.sh
```

### è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆ

âœ… æ£€æŸ¥ Python 3.9+ å’Œ Node.js 16+ æ˜¯å¦å·²å®‰è£…  
âœ… åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ (`backend/venv`)  
âœ… å®‰è£… Python ä¾èµ– (`pip install -r requirements.txt`)  
âœ… å®‰è£… Node.js ä¾èµ– (`npm install`)  
âœ… å¯åŠ¨åç«¯æœåŠ¡ (FastAPI, ç«¯å£ 19002)  
âœ… å¯åŠ¨å‰ç«¯æœåŠ¡ (Vite, ç«¯å£ 19001)  

### è®¿é—®åº”ç”¨

å¯åŠ¨å®Œæˆåï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

```
http://localhost:19001
```

> æç¤ºï¼šå¦‚æœè„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œè¯·å‚è€ƒ[è¯¦ç»†å®‰è£…æ­¥éª¤](#è¯¦ç»†å®‰è£…æ­¥éª¤)æˆ–[æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## è¯¦ç»†å®‰è£…æ­¥éª¤

> âš ï¸ **æ³¨æ„**ï¼šå¦‚æœå·²æˆåŠŸè¿è¡Œä¸€é”®è„šæœ¬ï¼Œå¯ä»¥è·³è¿‡æœ¬éƒ¨åˆ†ã€‚

### æ­¥éª¤ 1ï¼šå…‹éš†é¡¹ç›®

```bash
git clone https://github.com/soundstarrain/LLM-Filter-Probe.git
cd LLM-Filter-Probe
```

### æ­¥éª¤ 2ï¼šéªŒè¯ç¯å¢ƒ

æ£€æŸ¥æ˜¯å¦æ»¡è¶³ç³»ç»Ÿè¦æ±‚ï¼š

```bash
python --version    # éœ€è¦ 3.9+
node --version      # éœ€è¦ 16.0+
npm --version       # éœ€è¦ 8.0+
```

å¦‚æœç‰ˆæœ¬ä¸ç¬¦ï¼Œè¯·å…ˆå‡çº§ç›¸åº”è½¯ä»¶ã€‚

### æ­¥éª¤ 3ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
cd backend
python -m venv venv
```

æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š

```bash
# Windows
venv\Scripts\activate

# macOS / Linux
source venv/bin/activate
```

### æ­¥éª¤ 4ï¼šå®‰è£…ä¾èµ–

```bash
# å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# å®‰è£… Node.js ä¾èµ–
cd ../frontend
npm install
```

### æ­¥éª¤ 5ï¼šå¯åŠ¨åº”ç”¨

#### æ–¹å¼ Aï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..

# Windows
start_system.bat

# macOS / Linux
bash start_system.sh
```

#### æ–¹å¼ Bï¼šæ‰‹åŠ¨å¯åŠ¨

æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯çª—å£ï¼š

**ç»ˆç«¯ 1 - å¯åŠ¨åç«¯**ï¼š
```bash
cd backend
source venv/bin/activate  # macOS/Linux æˆ– venv\Scripts\activate (Windows)
python -m uvicorn main:app --reload
```

**ç»ˆç«¯ 2 - å¯åŠ¨å‰ç«¯**ï¼š
```bash
cd frontend
npm run dev
```

### æ­¥éª¤ 6ï¼šéªŒè¯åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

```
http://localhost:19001
```

å¦‚æœçœ‹åˆ°åº”ç”¨ç•Œé¢ï¼Œè¯´æ˜å®‰è£…æˆåŠŸï¼ğŸ‰

---

## é…ç½®è¯´æ˜

### ç³»ç»Ÿé…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`config/system.json`

```json
{
  "host": "0.0.0.0",
  "port": 19002,
  "log_level": "INFO",
  "cors_origins": ["http://localhost:19001", "http://localhost:3000"]
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `host` | åç«¯æœåŠ¡ç›‘å¬åœ°å€ | 0.0.0.0 |
| `port` | åç«¯æœåŠ¡ç«¯å£ | 19002 |
| `log_level` | æ—¥å¿—çº§åˆ« (DEBUG/INFO/WARNING/ERROR) | INFO |
| `cors_origins` | å…è®¸çš„è·¨åŸŸæ¥æº | è§ä¸Š |

### API å‡­è¯

**æ–‡ä»¶ä½ç½®**ï¼š`config/API/credentials.json`

```json
{
  "api_url": "https://api.openai.com/v1",
  "api_key": "sk-...",
  "api_model": "gpt-4o-mini"
}
```

> âš ï¸ **å®‰å…¨æç¤º**ï¼šä¸è¦å°† API å¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä½¿ç”¨ `.gitignore` æ’é™¤æ­¤æ–‡ä»¶ã€‚

### é«˜çº§è®¾ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`config/settings/default.json`

è¯¦ç»†å‚æ•°è¯´æ˜è¯·å‚è€ƒ [PARAMETER_REFERENCE.md](./PARAMETER_REFERENCE.md)

### é¢„è®¾è§„åˆ™

**æ–‡ä»¶ä½ç½®**ï¼š`config/presets/{preset}.json`

| æ–‡ä»¶ | è¯´æ˜ | æƒé™ |
|------|------|------|
| `official.json` | å®˜æ–¹ API è§„åˆ™ | åªè¯» |
| `relay.json` | ä¸­è½¬æœåŠ¡è§„åˆ™ | åªè¯» |
| `custom.json` | ç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™ | å¯å†™ |

---

## v1.2.0 æ–°åŠŸèƒ½é…ç½®

### 1. ç­‰é•¿å»¶è¿Ÿæ©ç æœºåˆ¶

**è‡ªåŠ¨å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚ç³»ç»Ÿä¼šåœ¨å¹¶å‘æ‰«æè¿‡ç¨‹ä¸­è‡ªåŠ¨åº”ç”¨å·²çŸ¥æ•æ„Ÿè¯çš„æ©ç ã€‚

**å·¥ä½œåŸç†**ï¼š
- æ•æ„Ÿè¯æ›¿æ¢ä¸ºç›¸åŒé•¿åº¦çš„ `*`ï¼Œä¿æŒæ–‡æœ¬é•¿åº¦ä¸å˜
- åœ¨è·å–ä¿¡å·é‡åã€å‘é€è¯·æ±‚å‰åº”ç”¨æ©ç 
- è‹¥æ©ç åæ–‡æœ¬ä¸ºç©ºï¼Œç›´æ¥è·³è¿‡ API è¯·æ±‚

**æ€§èƒ½æå‡**ï¼šåœ¨å¹¶å‘ 15 çš„åœºæ™¯ä¸‹ï¼Œæ•´ä½“ API è°ƒç”¨å‡å°‘ **40-60%**

### 2. æ£€éªŒæµç¨‹ä¸‰é˜¶æ®µç®—æ³•

**è‡ªåŠ¨å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚ç³»ç»Ÿä¼šåœ¨æ‰«æå®Œæˆåè‡ªåŠ¨æ‰§è¡Œä¸‰é˜¶æ®µç²¾ç‚¼æµç¨‹ã€‚

**ä¸‰ä¸ªé˜¶æ®µ**ï¼š
1. **éªŒè¯é˜¶æ®µ**ï¼šå¯¹æ‰€æœ‰å€™é€‰ç‰‡æ®µè¿›è¡Œ API å†æ¬¡éªŒè¯ï¼Œè¿‡æ»¤æ‰"å¹»è§‰é•¿å¥"
2. **ç²¾ç‚¼é˜¶æ®µ**ï¼šå¤„ç†å€™é€‰ç‰‡æ®µä¸­çš„åŒ…å«å…³ç³»ï¼Œæå–æœ€ç»ˆçš„æ ¸å¿ƒå…³é”®è¯
3. **æ¸…ç‚¹é˜¶æ®µ**ï¼šç”¨æ ¸å¿ƒå…³é”®è¯é‡æ–°è¿›è¡Œå…¨å±€æœç´¢ï¼Œå¾—åˆ°æœ€å‡†ç¡®çš„ä½ç½®å’Œæ•°é‡

**æ•´ä½“è¿‡æ»¤ç‡**ï¼šé€šå¸¸ **70-90%**ï¼Œæœ€ç»ˆç»“æœæ›´åŠ å‡†ç¡®å¯é 

### 3. å…¨å±€æ©ç ç®¡ç†å™¨

**è‡ªåŠ¨å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨ç®¡ç†å·²çŸ¥æ•æ„Ÿè¯åˆ—è¡¨ã€‚

**ç‰¹æ€§**ï¼š
- çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ RLock ä¿æŠ¤å…±äº«æ•°æ®ç»“æ„
- å¿«ç…§æœºåˆ¶ï¼šè·å–æ•æ„Ÿè¯åˆ—è¡¨æ—¶è¿”å›å‰¯æœ¬ï¼Œé¿å…å¹¶å‘ä¿®æ”¹
- ç»Ÿè®¡ä¿¡æ¯ï¼šæä¾›æ©ç ç»Ÿè®¡æ¥å£ï¼Œä¾¿äºç›‘æ§å’Œè°ƒè¯•

### 4. é…ç½®å®šä¹‰ç»Ÿä¸€

**è‡ªåŠ¨å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ç»Ÿä¸€çš„é…ç½®å®šä¹‰ã€‚

**ç‰¹æ€§**ï¼š
- å­—æ®µåˆ†ç±»ï¼šå‡­è¯ã€è®¾ç½®ã€è§„åˆ™ä¸‰å¤§ç±»
- éªŒè¯è§„åˆ™ï¼šç»Ÿä¸€çš„å­—æ®µéªŒè¯é€»è¾‘ï¼Œæ¶ˆé™¤é‡å¤ä»£ç 
- ç±»å‹è½¬æ¢ï¼šé›†ä¸­ç®¡ç†ç±»å‹è½¬æ¢è§„åˆ™
- é»˜è®¤å€¼ç®¡ç†ï¼šç»Ÿä¸€çš„é»˜è®¤å€¼å®šä¹‰

### 5. ç»“æ„åŒ–æ—¥å¿—å·¥å…·

**è‡ªåŠ¨å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—ã€‚

**ç‰¹æ€§**ï¼š
- é˜¶æ®µæ—¥å¿—ï¼šä¸ºæ£€éªŒæµç¨‹å„é˜¶æ®µæä¾›ä¸“ç”¨æ—¥å¿—æ–¹æ³•
- ç»Ÿè®¡æ—¥å¿—ï¼šè®°å½•å…³é”®è¯å‘ç°ã€éªŒè¯å®Œæˆç­‰é‡è¦äº‹ä»¶
- æ ¼å¼ç»Ÿä¸€ï¼šæ¶ˆé™¤æ—¥å¿—æ ¼å¼ä¸ä¸€è‡´çš„é—®é¢˜

### 6. æœªçŸ¥çŠ¶æ€ç ç»Ÿè®¡

**è‡ªåŠ¨å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚ç³»ç»Ÿä¼šåœ¨æ‰«æå®Œæˆæ—¶è‡ªåŠ¨ç»Ÿè®¡æœªçŸ¥çŠ¶æ€ç ã€‚

**ç‰¹æ€§**ï¼š
- å‡ºç°æ¬¡æ•°ç»Ÿè®¡ï¼šè®°å½•æ¯ä¸ªæœªçŸ¥çŠ¶æ€ç å‡ºç°çš„æ¬¡æ•°
- å¤„ç†å»ºè®®ï¼šä¸ºä¸åŒç±»å‹çš„çŠ¶æ€ç æä¾›é…ç½®å»ºè®®
- å‰ç«¯å±•ç¤ºï¼šåœ¨ç»“æœé¡µé¢æ˜¾ç¤ºæœªçŸ¥çŠ¶æ€ç ç»Ÿè®¡ä¿¡æ¯

### 7. æ•æ„Ÿè¯åˆ¤æ–­ä¾æ®è®°å½•

**è‡ªåŠ¨å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•æ¯ä¸ªæ•æ„Ÿè¯çš„åˆ¤æ–­ä¾æ®ã€‚

**ç‰¹æ€§**ï¼š
- è¯æ®é“¾è¿½è¸ªï¼šè®°å½•æ•æ„Ÿè¯çš„å‘ç°æ—¶é—´å’Œä¸Šä¸‹æ–‡
- å‰ç«¯å±•ç¤ºï¼šåœ¨ç»“æœé¡µé¢æ˜¾ç¤ºæ•æ„Ÿè¯çš„åˆ¤æ–­ä¾æ®

### 8. æœç´¢ä¸åˆ†é¡µåŠŸèƒ½

**è‡ªåŠ¨å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚å‰ç«¯ä¼šè‡ªåŠ¨æä¾›æœç´¢å’Œåˆ†é¡µåŠŸèƒ½ã€‚

**ç‰¹æ€§**ï¼š
- å¿«é€ŸæŸ¥æ‰¾ç‰¹å®šæ•æ„Ÿè¯
- å®æ—¶è¿‡æ»¤ç»“æœåˆ—è¡¨
- æ”¯æŒè‡ªå®šä¹‰æ¯é¡µæ¡æ•°ï¼ˆ10/20/50/100ï¼‰
- è‡ªåŠ¨è®¡ç®—å…¨å±€åºå·

### 9. å¼ºåŠ›é‡è¯•æœºåˆ¶

**è‡ªåŠ¨å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ tenacity åº“è¿›è¡Œé‡è¯•ã€‚

**ç‰¹æ€§**ï¼š
- æ”¯æŒå¤šç§ç½‘ç»œå¼‚å¸¸çš„è‡ªåŠ¨é‡è¯•
- æŒ‡æ•°é€€é¿ç­–ç•¥ï¼Œæœ€å¤šé‡è¯• 5 æ¬¡
- ç½‘ç»œå¼‚å¸¸ä¸å†è¢«å½“ä½œ SAFE å¤„ç†

---

## Docker éƒ¨ç½²

### å‰ç½®æ¡ä»¶

```bash
docker --version         # éœ€è¦ 20.10+
docker-compose --version # éœ€è¦ 1.29+
```

### å¿«é€Ÿå¯åŠ¨

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### è®¿é—®åº”ç”¨

```
http://localhost:19001
```

### Docker Compose é…ç½®

**æ–‡ä»¶**ï¼š`docker-compose.yml`

```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "19002:19002"
    volumes:
      - ./config:/app/config
      - ./logs:/app/logs
    environment:
      - PYTHONUNBUFFERED=1

  frontend:
    build: ./frontend
    ports:
      - "19001:19001"
    depends_on:
      - backend
```

**å¸¸ç”¨å‘½ä»¤**ï¼š

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs backend

# é‡å¯æœåŠ¡
docker-compose restart

# åˆ é™¤å®¹å™¨å’Œå·
docker-compose down -v
```

---

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### æ¨èæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Nginx (åå‘ä»£ç†)                 â”‚
â”‚  (ç«¯å£ 80/443ï¼Œè´Ÿè½½å‡è¡¡)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI 1    â”‚   â”‚ FastAPI 2    â”‚
â”‚ (19002)      â”‚   â”‚ (19003)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                 â†‘
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PostgreSQL      â”‚
        â”‚  (é…ç½®å­˜å‚¨)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ­¥éª¤ 1ï¼šå®‰è£… Gunicorn

```bash
pip install gunicorn
```

å¯åŠ¨ Gunicornï¼š

```bash
gunicorn -w 4 -b 0.0.0.0:19002 backend.app:app
```

**å‚æ•°è¯´æ˜**ï¼š
- `-w 4` - å·¥ä½œè¿›ç¨‹æ•°ï¼ˆå»ºè®®ä¸º CPU æ ¸å¿ƒæ•° Ã— 2 + 1ï¼‰
- `-b 0.0.0.0:19002` - ç»‘å®šåœ°å€å’Œç«¯å£

### æ­¥éª¤ 2ï¼šé…ç½® Nginx

**æ–‡ä»¶**ï¼š`nginx.conf`

```nginx
upstream backend {
    server 127.0.0.1:19002;
    server 127.0.0.1:19003;
}

server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # å‰ç«¯
    location / {
        proxy_pass http://127.0.0.1:19001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # åç«¯ API
    location /api/ {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket
    location /ws/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### æ­¥éª¤ 3ï¼šè¿›ç¨‹ç®¡ç†ï¼ˆSupervisorï¼‰

**æ–‡ä»¶**ï¼š`supervisord.conf`

```ini
[program:backend]
command=gunicorn -w 4 -b 0.0.0.0:19002 backend.app:app
directory=/path/to/project/backend
autostart=true
autorestart=true
stderr_logfile=/var/log/backend.err.log
stdout_logfile=/var/log/backend.out.log

[program:frontend]
command=npm run preview
directory=/path/to/project/frontend
autostart=true
autorestart=true
stderr_logfile=/var/log/frontend.err.log
stdout_logfile=/var/log/frontend.out.log
```

å¯åŠ¨ Supervisorï¼š

```bash
supervisord -c supervisord.conf
supervisorctl status
```

### æ­¥éª¤ 4ï¼šSSL è¯ä¹¦é…ç½®

ä½¿ç”¨ Let's Encrypt è·å–å…è´¹è¯ä¹¦ï¼š

```bash
certbot certonly --standalone -d your-domain.com
```

è¯ä¹¦ä½ç½®ï¼š

```
/etc/letsencrypt/live/your-domain.com/fullchain.pem
/etc/letsencrypt/live/your-domain.com/privkey.pem
```

è‡ªåŠ¨ç»­æœŸï¼š

```bash
certbot renew --dry-run
```

---

## ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—æ–‡ä»¶

```
logs/
â”œâ”€â”€ app.log          # åº”ç”¨æ—¥å¿—
â”œâ”€â”€ audit.log        # å®¡è®¡æ—¥å¿—
â””â”€â”€ venv_setup.log   # è™šæ‹Ÿç¯å¢ƒè®¾ç½®æ—¥å¿—
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/app.log

# æŸ¥çœ‹æœ€å 100 è¡Œ
tail -100 logs/app.log

# æœç´¢é”™è¯¯æ—¥å¿—
grep ERROR logs/app.log

# æœç´¢ç‰¹å®šæ—¥æœŸçš„æ—¥å¿—
grep "2025-12-07" logs/app.log
```

### æ—¥å¿—çº§åˆ«

| çº§åˆ« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| DEBUG | è°ƒè¯•ä¿¡æ¯ | å˜é‡å€¼ã€å‡½æ•°è°ƒç”¨ |
| INFO | ä¸€èˆ¬ä¿¡æ¯ | åº”ç”¨å¯åŠ¨ã€è¯·æ±‚å¤„ç† |
| WARNING | è­¦å‘Šä¿¡æ¯ | é…ç½®é—®é¢˜ã€æ€§èƒ½è­¦å‘Š |
| ERROR | é”™è¯¯ä¿¡æ¯ | å¼‚å¸¸ã€API å¤±è´¥ |
| CRITICAL | ä¸¥é‡é”™è¯¯ | ç³»ç»Ÿå´©æºƒ |

### ä¿®æ”¹æ—¥å¿—çº§åˆ«

ç¼–è¾‘ `config/system.json`ï¼š

```json
{
  "log_level": "DEBUG"
}
```

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€
curl http://localhost:19002/health

# æ£€æŸ¥å‰ç«¯å¯è®¿é—®æ€§
curl http://localhost:19001
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šåç«¯æœåŠ¡æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**ï¼š
```
ERROR: Address already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
   ```bash
   # macOS / Linux
   lsof -i :19002
   
   # Windows
   netstat -ano | findstr :19002
   ```

2. æ€æ­»è¿›ç¨‹
   ```bash
   # macOS / Linux
   kill -9 <PID>
   
   # Windows
   taskkill /PID <PID> /F
   ```

3. æˆ–æ”¹ç”¨å…¶ä»–ç«¯å£
   ```bash
   python -m uvicorn main:app --port 19003
   ```

---

### é—®é¢˜ 2ï¼šå‰ç«¯æ— æ³•è¿æ¥åç«¯

**ç—‡çŠ¶**ï¼š
```
WebSocket connection failed
API request timeout
```

**æ£€æŸ¥æ¸…å•**ï¼š

- [ ] åç«¯æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Ÿ
  ```bash
  curl http://localhost:19002/health
  ```

- [ ] é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†ç«¯å£ï¼Ÿ
  ```bash
  # Windows
  netsh advfirewall firewall add rule name="Allow 19002" dir=in action=allow protocol=tcp localport=19002
  ```

- [ ] CORS é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
  ```json
  {
    "cors_origins": ["http://localhost:19001"]
  }
  ```

---

### é—®é¢˜ 3ï¼šAPI å‡­è¯æ— æ•ˆ

**ç—‡çŠ¶**ï¼š
```
401 Unauthorized
Invalid API key
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. æ£€æŸ¥ `config/API/credentials.json` ä¸­çš„ API å¯†é’¥
2. ç¡®è®¤ API å¯†é’¥æœªè¿‡æœŸ
3. æµ‹è¯• API è¿æ¥
   ```bash
   curl -H "Authorization: Bearer sk-..." https://api.openai.com/v1/models
   ```

---

### é—®é¢˜ 4ï¼šæ‰«æé€Ÿåº¦å¾ˆæ…¢

**ç—‡çŠ¶**ï¼š
```
æ‰«æè€—æ—¶è¶…è¿‡é¢„æœŸ
```

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

1. å¢åŠ å¹¶å‘æ•°
   ```json
   {
     "concurrency": 30
   }
   ```

2. å‡å°‘è¶…æ—¶æ—¶é—´
   ```json
   {
     "timeout_seconds": 15
   }
   ```

3. æ£€æŸ¥ç½‘ç»œè¿æ¥
   ```bash
   ping api.openai.com
   ```

---

### é—®é¢˜ 5ï¼šå†…å­˜å ç”¨è¿‡é«˜

**ç—‡çŠ¶**ï¼š
```
å†…å­˜ä½¿ç”¨ç‡ > 80%
```

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

1. å‡å°‘å¹¶å‘æ•°
   ```json
   {
     "concurrency": 10
   }
   ```

2. å‡å°‘åˆ†å—å¤§å°
   ```json
   {
     "chunk_size": 10000
   }
   ```

3. é‡å¯åº”ç”¨
   ```bash
   docker-compose restart
   ```

---

### é—®é¢˜ 6ï¼šä¸€é”®è„šæœ¬æ‰§è¡Œå¤±è´¥

**å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆ**ï¼š

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| `Python not found` | Python æœªå®‰è£…æˆ–ä¸åœ¨ PATH | å®‰è£… Python 3.9+ |
| `Node not found` | Node.js æœªå®‰è£…æˆ–ä¸åœ¨ PATH | å®‰è£… Node.js 16+ |
| `Permission denied` | è„šæœ¬æ— æ‰§è¡Œæƒé™ | `chmod +x start_system.sh` |
| `pip install failed` | ç½‘ç»œé—®é¢˜æˆ–ä¾èµ–å†²çª | æ£€æŸ¥ç½‘ç»œï¼Œæ¸…é™¤ç¼“å­˜åé‡è¯• |

---

## å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨

| é—®é¢˜ | å¿«é€Ÿè§£å†³ |
|------|---------|
| å¦‚ä½•é‡å¯åº”ç”¨ï¼Ÿ | `docker-compose restart` æˆ–é‡æ–°è¿è¡Œè„šæœ¬ |
| å¦‚ä½•æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼Ÿ | `tail -f logs/app.log` |
| å¦‚ä½•ä¿®æ”¹ç«¯å£ï¼Ÿ | ç¼–è¾‘ `config/system.json` ä¸­çš„ `port` å­—æ®µ |
| å¦‚ä½•æ¸…é™¤ç¼“å­˜ï¼Ÿ | `rm -rf backend/venv frontend/node_modules` |
| å¦‚ä½•æ¢å¤é»˜è®¤é…ç½®ï¼Ÿ | åˆ é™¤ `config/` ç›®å½•ï¼Œé‡æ–°è¿è¡Œè„šæœ¬ |
| ç”Ÿäº§ç¯å¢ƒæ¨èç”¨ä»€ä¹ˆï¼Ÿ | Docker Compose æˆ– Nginx + Gunicorn |
